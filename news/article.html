<script>
const ENDPOINT = "https://cms.fountainlake.net/graphql";

const parts = window.location.pathname
  .replace(/\/+$/, "")
  .split("/")
  .filter(Boolean);

const slug = parts[1];

if (!slug) {
  document.body.innerHTML = "<h1>No article specified</h1>";
}

fetch(ENDPOINT, {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    query: `
      query GetArticle {
        newsItems(where: { slug: "${slug}" }) {
          nodes {
            title
            content
          }
        }
      }
    `
  })
})
.then(res => res.json())
.then(res => {
  const item = res.data?.newsItems?.nodes?.[0];
  if (!item) {
    document.body.innerHTML = "<h1>Article not found</h1>";
    return;
  }

  document.body.innerHTML = `
    <main style="max-width:720px;margin:auto">
      <h1>${item.title}</h1>
      ${item.content}
    </main>
  `;
})
.catch(err => {
  document.body.innerHTML =
    "<h1>Error</h1><pre>" + err + "</pre>";
});
</script>
